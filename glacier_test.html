<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Justin Lingg-Laham, Liev Paustian, Lisa Wohlgemuth">

<title>glacier_retreat</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="glacier_test_files/libs/clipboard/clipboard.min.js"></script>
<script src="glacier_test_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="glacier_test_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="glacier_test_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="glacier_test_files/libs/quarto-html/popper.min.js"></script>
<script src="glacier_test_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="glacier_test_files/libs/quarto-html/anchor.min.js"></script>
<link href="glacier_test_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="glacier_test_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="glacier_test_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="glacier_test_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="glacier_test_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">glacier_retreat</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Justin Lingg-Laham, Liev Paustian, Lisa Wohlgemuth </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Remote Sensing Applications: Group Glacial Retreat Part 2: statistical Analysis in R</p>
<p>This R script works on the post-processing, Glacial conditions, climate variables and Hypsometryy for the Fox Glacier in New Zealand</p>
<p>Inputs (from GEE): - fox_glacier.csv (Part 1.2) - Fox_Climate_ERA5Land_1989_2025.csv (Part 1.3) - Fox_hypsometry_bins.csv (Part 1.4)</p>
<section id="preparation" class="level2">
<h2 class="anchored" data-anchor-id="preparation">Preparation</h2>
<p>To ensure Reproducibility, it is crucial to understand that when the document is rendered, the working directory is automatically set to the folder in which it is located. Therefore, it is necessary to maintain the attached folder structure! The data import takes place via relative paths to be independent from local storage pathways from different computersystems.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/Users/justi/OneDrive/Desktop/UGM Semester 1/remote_sensing_applications/storyMap_glacier"</code></pre>
</div>
</div>
</section>
<section id="librarys" class="level2">
<h2 class="anchored" data-anchor-id="librarys">Librarys</h2>
<p>The following Libraries are used to provide access to additional functions:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.6
✔ forcats   1.0.1     ✔ stringr   1.6.0
✔ ggplot2   4.0.1     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.2
✔ purrr     1.2.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)   </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'MASS'

Das folgende Objekt ist maskiert 'package:dplyr':

    select</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'scales'

Das folgende Objekt ist maskiert 'package:purrr':

    discard

Das folgende Objekt ist maskiert 'package:readr':

    col_factor</code></pre>
</div>
</div>
</section>
</section>
<section id="data" class="level1">
<h1>1. Data</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load Data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>glacier_30 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/raw/fox_glacier.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> <span class="cn">TRUE</span>) <span class="co"># Satellite-Data of Fox-Glacier</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>clim <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/raw/Fox_Climate_ERA5Land_1989_2025.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> <span class="cn">TRUE</span>) <span class="co"># ERA5-land climate data</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Clean glacier-data ((first steps in GEE))</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> glacier_30 <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.integer</span>(year),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">doSnowline =</span> doSnowline <span class="sc">%in%</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="st">"TRUE"</span>, <span class="dv">1</span>, <span class="st">"1"</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ok_overall =</span> ok_overall <span class="sc">%in%</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="st">"TRUE"</span>, <span class="dv">1</span>, <span class="st">"1"</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ok_clear   =</span> ok_clear   <span class="sc">%in%</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="st">"TRUE"</span>, <span class="dv">1</span>, <span class="st">"1"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Snowline subset (Define a Quality-Threshold)</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>snow_cf_thr  <span class="ot">&lt;-</span> <span class="fl">0.20</span> <span class="co">#at least 20% clear pixel for snowline</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>snow_min_km2 <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co">#at least 5 km2 glacier-area</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#produce quality-snowline data</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>snow_df <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    doSnowline <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(snowline_edge_m),</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    nSnow <span class="sc">&gt;=</span> <span class="dv">3</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    clearFraction_snow <span class="sc">&gt;=</span> snow_cf_thr,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(glacier_km2),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    glacier_km2 <span class="sc">&gt;=</span> snow_min_km2</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Area subset (Quality-trheshold)</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>area_min_km2 <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="co">#at least 10 km2 to be area</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>area_strict <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    ok_overall <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(glacier_km2),</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    imgCount <span class="sc">&gt;=</span> <span class="dv">5</span>,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    clearFraction <span class="sc">&gt;=</span> <span class="fl">0.20</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    glacier_km2 <span class="sc">&gt;=</span> area_min_km2</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">#Output Statistics</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Years total:"</span>, <span class="fu">nrow</span>(df2), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Years total: 37 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Snowline clean years:"</span>, <span class="fu">nrow</span>(snow_df), <span class="st">" (unique:"</span>, <span class="fu">n_distinct</span>(snow_df<span class="sc">$</span>year), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Snowline clean years: 26  (unique: 26 )</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Area STRICT years:"</span>, <span class="fu">nrow</span>(area_strict), <span class="st">" (unique:"</span>, <span class="fu">n_distinct</span>(area_strict<span class="sc">$</span>year), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area STRICT years: 28  (unique: 28 )</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>glacier_30</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   system.index LST_median_C clearFraction clearFraction_snow             dem
1             0   -2.6655239     0.9110165                 NA NASADEM_HGT_001
2             1   -1.3791870     0.8288045         0.09540215 NASADEM_HGT_001
3             2           NA            NA                 NA NASADEM_HGT_001
4             3    0.1883497     0.5972790                 NA NASADEM_HGT_001
5             4           NA            NA         0.52652108 NASADEM_HGT_001
6             5           NA            NA                 NA NASADEM_HGT_001
7             6           NA            NA                 NA NASADEM_HGT_001
8             7           NA            NA                 NA NASADEM_HGT_001
9             8           NA            NA                 NA NASADEM_HGT_001
10            9           NA            NA                 NA NASADEM_HGT_001
11           10    0.1141623     0.9926243                 NA NASADEM_HGT_001
12           11   -1.6247016     0.9947841         0.95314867 NASADEM_HGT_001
13           12   -0.1235998     0.9948972         0.95734230 NASADEM_HGT_001
14           13   -0.1190369     0.9930122         0.94625484 NASADEM_HGT_001
15           14   -3.8138686     0.9948972         0.94847206 NASADEM_HGT_001
16           15   -0.7519912     0.9948972         0.97987759 NASADEM_HGT_001
17           16   -1.1173180     0.9948972         0.99489725 NASADEM_HGT_001
18           17   -2.8695976     0.9948972         0.95810781 NASADEM_HGT_001
19           18   -4.3835361     0.9947841         0.94609207 NASADEM_HGT_001
20           19   -2.3672767     0.9948972         0.78201293 NASADEM_HGT_001
21           20    0.3631330     0.9887109         0.92657722 NASADEM_HGT_001
22           21   -1.3721087     0.9948972         0.90607525 NASADEM_HGT_001
23           22   -1.1248176     0.9948972         0.92144216 NASADEM_HGT_001
24           23   -1.1181138     0.9947087         0.90549592 NASADEM_HGT_001
25           24   -0.3164327     0.9948972         0.89989156 NASADEM_HGT_001
26           25   -1.6161737     0.9948972         0.96807914 NASADEM_HGT_001
27           26   -0.3863064     0.9948595         0.92619440 NASADEM_HGT_001
28           27   -2.1916050     0.9948972         0.96537118 NASADEM_HGT_001
29           28   -1.6269220     0.9948972         0.95290438 NASADEM_HGT_001
30           29   -1.8745302     0.9948972         0.82766142 NASADEM_HGT_001
31           30   -0.8665033     0.9948595         0.92408040 NASADEM_HGT_001
32           31   -2.1225272     0.9948972         0.95578186 NASADEM_HGT_001
33           32   -0.1240118     0.9948972         0.95119025 NASADEM_HGT_001
34           33   -4.6206087     0.9948972         0.96203999 NASADEM_HGT_001
35           34   -2.1888442     0.9948218         0.97593090 NASADEM_HGT_001
36           35   -0.6179971     0.9805559         0.79597054 NASADEM_HGT_001
37           36   -1.1202263     0.9464714         0.89197016 NASADEM_HGT_001
   doSnowline  firstDate glacier_km2 imgCount   lastDate minClearFraction
1           0 1989-11-09    54.59791        6 1990-02-13              0.1
2           0 1990-12-14    51.72279        2 1990-12-30              0.1
3           0                     NA        0                         0.1
4           0 1992-12-19    34.01140        3 1993-02-21              0.1
5           0                     NA        0                         0.1
6           0                     NA        0                         0.1
7           0                     NA        0                         0.1
8           0                     NA        0                         0.1
9           0                     NA        0                         0.1
10          0                     NA        0                         0.1
11          0 1999-08-01    58.53726       19 2000-05-31              0.1
12          1 2000-08-03    61.03747       19 2001-05-18              0.1
13          1 2001-08-22    58.14506       16 2002-05-21              0.1
14          1 2002-08-09    60.99791       19 2003-05-24              0.1
15          1 2003-08-04    62.50721       33 2004-05-26              0.1
16          1 2004-08-06    62.83254       36 2005-05-29              0.1
17          1 2005-08-01    60.78639       29 2006-05-16              0.1
18          1 2006-08-04    62.53744       28 2007-05-03              0.1
19          1 2007-08-07    62.80676       23 2008-05-05              0.1
20          1 2008-08-09    61.94718       28 2009-05-24              0.1
21          1 2009-08-12    58.92360       18 2010-05-27              0.1
22          1 2010-08-06    61.38788       39 2011-05-30              0.1
23          1 2011-08-02    62.33307       23 2012-05-16              0.1
24          1 2012-08-04    60.31885       26 2013-05-27              0.1
25          1 2013-08-15    56.26001       36 2014-05-30              0.1
26          1 2014-08-02    55.24406       49 2015-05-25              0.1
27          1 2015-08-04    54.55226       44 2016-05-27              0.1
28          1 2016-08-06    57.79410       49 2017-05-30              0.1
29          1 2017-08-02    58.82634       50 2018-05-25              0.1
30          1 2018-08-05    59.10074       58 2019-05-28              0.1
31          1 2019-08-08    55.34453       56 2020-05-30              0.1
32          1 2020-08-01    58.94524       55 2021-05-17              0.1
33          1 2021-08-05    56.54383       49 2022-05-20              0.1
34          1 2022-08-08    56.12631       44 2023-05-23              0.1
35          1 2023-08-11    48.65823       29 2024-05-25              0.1
36          1 2024-08-13    47.52267       19 2025-05-28              0.1
37          1 2025-08-16    33.86997       11 2026-01-23              0.1
   minClearFraction_snowline minGlacierKm2_forSnowline minScenes_quality
1                        0.2                         5                 2
2                        0.2                         5                 2
3                        0.2                         5                 2
4                        0.2                         5                 2
5                        0.2                         5                 2
6                        0.2                         5                 2
7                        0.2                         5                 2
8                        0.2                         5                 2
9                        0.2                         5                 2
10                       0.2                         5                 2
11                       0.2                         5                 2
12                       0.2                         5                 2
13                       0.2                         5                 2
14                       0.2                         5                 2
15                       0.2                         5                 2
16                       0.2                         5                 2
17                       0.2                         5                 2
18                       0.2                         5                 2
19                       0.2                         5                 2
20                       0.2                         5                 2
21                       0.2                         5                 2
22                       0.2                         5                 2
23                       0.2                         5                 2
24                       0.2                         5                 2
25                       0.2                         5                 2
26                       0.2                         5                 2
27                       0.2                         5                 2
28                       0.2                         5                 2
29                       0.2                         5                 2
30                       0.2                         5                 2
31                       0.2                         5                 2
32                       0.2                         5                 2
33                       0.2                         5                 2
34                       0.2                         5                 2
35                       0.2                         5                 2
36                       0.2                         5                 2
37                       0.2                         5                 2
   minScenes_snowline nSnow ndsiThr ok_clear ok_overall ok_scenes scale_m
1                   3     0     0.4        1          1         1      30
2                   3     3     0.4        1          1         1      30
3                   3     0     0.4    false      false         0      30
4                   3     0     0.4        1          1         1      30
5                   3     2     0.4    false      false         0      30
6                   3     0     0.4    false      false         0      30
7                   3     0     0.4    false      false         0      30
8                   3     0     0.4    false      false         0      30
9                   3     0     0.4    false      false         0      30
10                  3     0     0.4    false      false         0      30
11                  3     0     0.4        1          1         1      30
12                  3     6     0.4        1          1         1      30
13                  3     6     0.4        1          1         1      30
14                  3     5     0.4        1          1         1      30
15                  3     5     0.4        1          1         1      30
16                  3    10     0.4        1          1         1      30
17                  3    11     0.4        1          1         1      30
18                  3     9     0.4        1          1         1      30
19                  3     7     0.4        1          1         1      30
20                  3     6     0.4        1          1         1      30
21                  3     9     0.4        1          1         1      30
22                  3     8     0.4        1          1         1      30
23                  3    15     0.4        1          1         1      30
24                  3     6     0.4        1          1         1      30
25                  3     6     0.4        1          1         1      30
26                  3    12     0.4        1          1         1      30
27                  3    17     0.4        1          1         1      30
28                  3    13     0.4        1          1         1      30
29                  3    13     0.4        1          1         1      30
30                  3    18     0.4        1          1         1      30
31                  3    18     0.4        1          1         1      30
32                  3    17     0.4        1          1         1      30
33                  3    18     0.4        1          1         1      30
34                  3    16     0.4        1          1         1      30
35                  3    16     0.4        1          1         1      30
36                  3     7     0.4        1          1         1      30
37                  3     6     0.4        1          1         1      30
     season snowElev_p10_m snowElev_p50_m snowElev_p90_m snowWindow
1  8/1–5/31             NA             NA             NA   1/1–3/31
2  8/1–5/31             NA             NA             NA   1/1–3/31
3  8/1–5/31             NA             NA             NA   1/1–3/31
4  8/1–5/31             NA             NA             NA   1/1–3/31
5  8/1–5/31             NA             NA             NA   1/1–3/31
6  8/1–5/31             NA             NA             NA   1/1–3/31
7  8/1–5/31             NA             NA             NA   1/1–3/31
8  8/1–5/31             NA             NA             NA   1/1–3/31
9  8/1–5/31             NA             NA             NA   1/1–3/31
10 8/1–5/31             NA             NA             NA   1/1–3/31
11 8/1–5/31             NA             NA             NA   1/1–3/31
12 8/1–5/31       1735.667       2279.669       2759.372   1/1–3/31
13 8/1–5/31       1703.758       2263.553       2743.553   1/1–3/31
14 8/1–5/31       1752.184       2279.684       2743.477   1/1–3/31
15 8/1–5/31       1735.636       2279.669       2759.465   1/1–3/31
16 8/1–5/31       1752.044       2279.658       2743.611   1/1–3/31
17 8/1–5/31       1623.369       2263.557       2743.478   1/1–3/31
18 8/1–5/31       1767.871       2295.376       2759.444   1/1–3/31
19 8/1–5/31       1719.902       2279.676       2759.438   1/1–3/31
20 8/1–5/31       1735.837       2247.361       2615.249   1/1–3/31
21 8/1–5/31       1735.852       2279.681       2743.587   1/1–3/31
22 8/1–5/31       1767.872       2279.667       2711.637   1/1–3/31
23 8/1–5/31       1767.840       2295.399       2759.479   1/1–3/31
24 8/1–5/31       1799.398       2295.391       2743.534   1/1–3/31
25 8/1–5/31       1783.393       2279.692       2727.262   1/1–3/31
26 8/1–5/31       1783.398       2295.395       2743.479   1/1–3/31
27 8/1–5/31       1767.950       2279.736       2743.631   1/1–3/31
28 8/1–5/31       1767.852       2279.670       2727.348   1/1–3/31
29 8/1–5/31       1783.358       2295.382       2743.462   1/1–3/31
30 8/1–5/31       1767.888       2295.453       2615.222   1/1–3/31
31 8/1–5/31       1783.372       2263.555       2663.502   1/1–3/31
32 8/1–5/31       1799.431       2279.660       2743.571   1/1–3/31
33 8/1–5/31       1767.821       2279.690       2711.719   1/1–3/31
34 8/1–5/31       1783.445       2279.645       2727.198   1/1–3/31
35 8/1–5/31       1847.799       2295.384       2727.297   1/1–3/31
36 8/1–5/31       1863.516       2263.540       2663.267   1/1–3/31
37 8/1–5/31       1863.428       2311.265       2727.185   1/1–3/31
   snowline_edge_m swir1Max windowUsed year
1               NA      0.2     SEASON 1989
2               NA      0.2     SEASON 1990
3               NA      0.2     SEASON 1991
4               NA      0.2     SEASON 1992
5               NA      0.2     SEASON 1993
6               NA      0.2     SEASON 1994
7               NA      0.2     SEASON 1995
8               NA      0.2     SEASON 1996
9               NA      0.2     SEASON 1997
10              NA      0.2     SEASON 1998
11              NA      0.2     SEASON 1999
12        1799.779      0.2     SEASON 2000
13        2040.116      0.2     SEASON 2001
14        2359.085      0.2     SEASON 2002
15        1847.977      0.2     SEASON 2003
16        2246.498      0.2     SEASON 2004
17        1606.890      0.2     SEASON 2005
18        1927.910      0.2     SEASON 2006
19        1831.244      0.2     SEASON 2007
20        2391.911      0.2     SEASON 2008
21        2295.152      0.2     SEASON 2009
22        2359.230      0.2     SEASON 2010
23        2150.925      0.2     SEASON 2011
24        2327.392      0.2     SEASON 2012
25        2311.494      0.2     SEASON 2013
26        2311.198      0.2     SEASON 2014
27        2310.692      0.2     SEASON 2015
28        2391.306      0.2     SEASON 2016
29        2376.221      0.2     SEASON 2017
30        2295.034      0.2     SEASON 2018
31        2391.023      0.2     SEASON 2019
32        2359.357      0.2     SEASON 2020
33        2359.391      0.2     SEASON 2021
34        2423.416      0.2     SEASON 2022
35        2375.859      0.2     SEASON 2023
36        2423.195      0.2     SEASON 2024
37        2375.664      0.2     SEASON 2025
                                     .geo
1  {"type":"MultiPoint","coordinates":[]}
2  {"type":"MultiPoint","coordinates":[]}
3  {"type":"MultiPoint","coordinates":[]}
4  {"type":"MultiPoint","coordinates":[]}
5  {"type":"MultiPoint","coordinates":[]}
6  {"type":"MultiPoint","coordinates":[]}
7  {"type":"MultiPoint","coordinates":[]}
8  {"type":"MultiPoint","coordinates":[]}
9  {"type":"MultiPoint","coordinates":[]}
10 {"type":"MultiPoint","coordinates":[]}
11 {"type":"MultiPoint","coordinates":[]}
12 {"type":"MultiPoint","coordinates":[]}
13 {"type":"MultiPoint","coordinates":[]}
14 {"type":"MultiPoint","coordinates":[]}
15 {"type":"MultiPoint","coordinates":[]}
16 {"type":"MultiPoint","coordinates":[]}
17 {"type":"MultiPoint","coordinates":[]}
18 {"type":"MultiPoint","coordinates":[]}
19 {"type":"MultiPoint","coordinates":[]}
20 {"type":"MultiPoint","coordinates":[]}
21 {"type":"MultiPoint","coordinates":[]}
22 {"type":"MultiPoint","coordinates":[]}
23 {"type":"MultiPoint","coordinates":[]}
24 {"type":"MultiPoint","coordinates":[]}
25 {"type":"MultiPoint","coordinates":[]}
26 {"type":"MultiPoint","coordinates":[]}
27 {"type":"MultiPoint","coordinates":[]}
28 {"type":"MultiPoint","coordinates":[]}
29 {"type":"MultiPoint","coordinates":[]}
30 {"type":"MultiPoint","coordinates":[]}
31 {"type":"MultiPoint","coordinates":[]}
32 {"type":"MultiPoint","coordinates":[]}
33 {"type":"MultiPoint","coordinates":[]}
34 {"type":"MultiPoint","coordinates":[]}
35 {"type":"MultiPoint","coordinates":[]}
36 {"type":"MultiPoint","coordinates":[]}
37 {"type":"MultiPoint","coordinates":[]}</code></pre>
</div>
</div>
</section>
<section id="statistics-trends-correlation-area-vs.-snowline" class="level1">
<h1>2. Statistics: Trends, correlation (Area vs.&nbsp;Snowline)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Trends </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>snow_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(snowline_edge_m <span class="sc">~</span> year, <span class="at">data =</span> snow_df) <span class="co">#Snowline (linear model with Snow-height per year)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>area_lm_strict <span class="ot">&lt;-</span> <span class="fu">lm</span>(glacier_km2 <span class="sc">~</span> year, <span class="at">data =</span> area_strict) <span class="co">#Area (linear model with glacier area per year)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(snow_lm))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = snowline_edge_m ~ year, data = snow_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-466.81  -59.59   17.82   88.88  346.49 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -38763.865   9155.407  -4.234 0.000291 ***
year            20.368      4.549   4.477 0.000157 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 174 on 24 degrees of freedom
Multiple R-squared:  0.4551,    Adjusted R-squared:  0.4324 
F-statistic: 20.05 on 1 and 24 DF,  p-value: 0.000157</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(area_lm_strict))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = glacier_km2 ~ year, data = area_strict)

Residuals:
    Min      1Q  Median      3Q     Max 
-18.545  -1.257   1.588   3.241   4.822 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 789.4964   225.3860   3.503  0.00168 **
year         -0.3640     0.1121  -3.248  0.00320 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.194 on 26 degrees of freedom
Multiple R-squared:  0.2886,    Adjusted R-squared:  0.2613 
F-statistic: 10.55 on 1 and 26 DF,  p-value: 0.003198</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mechanism: area vs snowline (correlation between both)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>rel_lm  <span class="ot">&lt;-</span> <span class="fu">lm</span>(glacier_km2 <span class="sc">~</span> snowline_edge_m, <span class="at">data =</span> snow_df)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>rel_rob <span class="ot">&lt;-</span> <span class="fu">rlm</span>(glacier_km2 <span class="sc">~</span> snowline_edge_m, <span class="at">data =</span> snow_df)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(rel_lm))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = glacier_km2 ~ snowline_edge_m, data = snow_df)

Residuals:
     Min       1Q   Median       3Q      Max 
-21.9781  -1.3023   0.8466   2.9671   6.2804 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     82.364474  11.263818   7.312 1.49e-07 ***
snowline_edge_m -0.011162   0.005033  -2.218   0.0363 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.811 on 24 degrees of freedom
Multiple R-squared:  0.1701,    Adjusted R-squared:  0.1355 
F-statistic: 4.918 on 1 and 24 DF,  p-value: 0.0363</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(rel_rob))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: rlm(formula = glacier_km2 ~ snowline_edge_m, data = snow_df)
Residuals:
     Min       1Q   Median       3Q      Max 
-23.6238  -2.0034   0.6167   1.5450   4.5778 

Coefficients:
                Value   Std. Error t value
(Intercept)     75.6886  6.4878    11.6663
snowline_edge_m -0.0077  0.0029    -2.6419

Residual standard error: 2.928 on 24 degrees of freedom</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlations</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>cor_test_p <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(snow_df<span class="sc">$</span>glacier_km2, snow_df<span class="sc">$</span>snowline_edge_m, <span class="at">method =</span> <span class="st">"pearson"</span>) <span class="co">#Pearson correlation: linear correlation</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>cor_test_s <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(snow_df<span class="sc">$</span>glacier_km2, snow_df<span class="sc">$</span>snowline_edge_m, <span class="at">method =</span> <span class="st">"spearman"</span>) <span class="co">#Spearman correlation: monotone correlation</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_test_p)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  snow_df$glacier_km2 and snow_df$snowline_edge_m
t = -2.2177, df = 24, p-value = 0.0363
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.68958792 -0.02979931
sample estimates:
       cor 
-0.4123911 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_test_s)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  snow_df$glacier_km2 and snow_df$snowline_edge_m
S = 4630, p-value = 0.00214
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
-0.582906 </code></pre>
</div>
</div>
</section>
<section id="plots-glacier" class="level1">
<h1>3. Plots (Glacier)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Snowline-TimeSeries (January-March)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>snow_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(snowline_edge_m <span class="sc">~</span> year, <span class="at">data =</span> snow_df)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>ann <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">glance</span>(snow_fit) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>( <span class="at">r2 =</span> <span class="fu">round</span>(r.squared, <span class="dv">2</span>), <span class="at">p  =</span> <span class="fu">signif</span>(p.value, <span class="dv">2</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(snow_fit) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>label_txt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Trend: "</span>, <span class="fu">round</span>(slope, <span class="dv">1</span>), <span class="st">" m/Year"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | R² = "</span>, ann<span class="sc">$</span>r2,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | p = "</span>, ann<span class="sc">$</span>p</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(snow_df, <span class="fu">aes</span>(year, snowline_edge_m)) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"#00B8D9"</span>) <span class="sc">+</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"label"</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">max</span>(snow_df<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">min</span>(snow_df<span class="sc">$</span>snowline_edge_m, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">40</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> label_txt,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.9</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"TimeSeries: Snowline (snowmask-edge) for the Fox Glacier"</span>,</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly Snowline-height [m] (Jan–Mar)"</span>,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Snowline elevation [m]"</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in annotate("label", x = max(snow_df$year, na.rm = TRUE) - 1, y =
min(snow_df$snowline_edge_m, : Ignoring unknown parameters: `label.size`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Area-TimeSeries (August-May)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>area_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(glacier_km2 <span class="sc">~</span> year, <span class="at">data =</span> area_strict)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>gl <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">glance</span>(area_fit)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(area_fit) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>label_txt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Trend: "</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">" km²/Year"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | R² = "</span>, <span class="fu">round</span>(gl<span class="sc">$</span>r.squared, <span class="dv">2</span>),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | p = "</span>, <span class="fu">signif</span>(gl<span class="sc">$</span>p.value, <span class="dv">2</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>p2_strict <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(area_strict, <span class="fu">aes</span>(year, glacier_km2)) <span class="sc">+</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"#00B8D9"</span>,) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"TimeSeries: Glacier-area of the Fox Glacier"</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly Area [km²] (Aug-May)"</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Area (km²)"</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlatiion: Area vs. Snowline</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust model</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>rel_rob <span class="ot">&lt;-</span> <span class="fu">rlm</span>(glacier_km2 <span class="sc">~</span> snowline_edge_m, <span class="at">data =</span> snow_df)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Slope</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>rob_slope <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(rel_rob) <span class="sc">%&gt;%</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"snowline_edge_m"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>cor_p <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(snow_df<span class="sc">$</span>glacier_km2, snow_df<span class="sc">$</span>snowline_edge_m, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>cor_s <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(snow_df<span class="sc">$</span>glacier_km2, snow_df<span class="sc">$</span>snowline_edge_m, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>label_txt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Robust slope: "</span>, <span class="fu">round</span>(rob_slope, <span class="dv">3</span>), <span class="st">" km² per m</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pearson r = "</span>, <span class="fu">round</span>(<span class="fu">unname</span>(cor_p<span class="sc">$</span>estimate), <span class="dv">2</span>), <span class="st">", p = "</span>, <span class="fu">signif</span>(cor_p<span class="sc">$</span>p.value, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Spearman ρ = "</span>, <span class="fu">round</span>(<span class="fu">unname</span>(cor_s<span class="sc">$</span>estimate), <span class="dv">2</span>), <span class="st">", p = "</span>, <span class="fu">signif</span>(cor_s<span class="sc">$</span>p.value, <span class="dv">2</span>)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>p3_rob <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(snow_df, <span class="fu">aes</span>(snowline_edge_m, glacier_km2)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"rlm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"#00B8D9"</span>) <span class="sc">+</span> <span class="fu">annotate</span>(</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"label"</span>,</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">max</span>(snow_df<span class="sc">$</span>snowline_edge_m, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">min</span>(snow_df<span class="sc">$</span>glacier_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fl">1.2</span>,</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> label_txt,</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Correlation: Area vs. Snowline for Fox Glacier"</span>,</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Higher snowline years tend to have smaller area "</span>,</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Snowline elevation [m]"</span>,</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Area (km²)"</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in annotate("label", x = max(snow_df$snowline_edge_m, na.rm = TRUE), :
Ignoring unknown parameters: `label.size`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save and export</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_glacier/fox_snowline_timeseries.png"</span>, p1, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">200</span>)      </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_glacier/fox_area_timeseries_strict.png"</span>, p2_strict, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">200</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_glacier/fox_area_vs_snowline_robust.png"</span>, p3_rob, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">200</span>)   </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
</div>
</section>
<section id="climate-analysis-preciptation-temperature-era5" class="level1">
<h1>4. Climate Analysis (Preciptation, Temperature) ERA5</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#prepare the data</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>clim2 <span class="ot">&lt;-</span> clim <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nMonths_season <span class="sc">&gt;</span> <span class="dv">0</span>, nMonths_summer <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#join climate data to glacier</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    clim2 <span class="sc">%&gt;%</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        year,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        t2m_C_mean_season, tp_mm_sum_season,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        t2m_C_mean_summer, tp_mm_sum_summer,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        t2m_C_pos_sum_summer,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        nMonths_season, nMonths_summer</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"year"</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Joined years:"</span>, <span class="fu">nrow</span>(df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Joined years: 37 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Years with climate:"</span>, <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>t2m_C_mean_summer)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Years with climate: 34 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recreate subsets WITH climate availability</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>snow_df_c <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    doSnowline <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(snowline_edge_m),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    nSnow <span class="sc">&gt;=</span> <span class="dv">3</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    clearFraction_snow <span class="sc">&gt;=</span> snow_cf_thr,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(glacier_km2),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    glacier_km2 <span class="sc">&gt;=</span> snow_min_km2,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(t2m_C_mean_summer)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>area_strict_c <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    ok_overall <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(glacier_km2),</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    imgCount <span class="sc">&gt;=</span> <span class="dv">5</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    clearFraction <span class="sc">&gt;=</span> <span class="fl">0.20</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    glacier_km2 <span class="sc">&gt;=</span> area_min_km2,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(tp_mm_sum_season),</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(t2m_C_mean_season)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="co">#output</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Snow years (strict + climate):"</span>, <span class="fu">nrow</span>(snow_df_c), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Snow years (strict + climate): 23 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Area years (strict + climate):"</span>, <span class="fu">nrow</span>(area_strict_c), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area years (strict + climate): 25 </code></pre>
</div>
</div>
</section>
<section id="plot-climate" class="level1">
<h1>5. Plot: Climate</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>clim_year <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(t2m_C_mean_summer)) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">t2m_C_mean_summer =</span> <span class="fu">mean</span>(t2m_C_mean_summer), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>clim_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(t2m_C_mean_summer <span class="sc">~</span> year, <span class="at">data =</span> clim_year)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>gl <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">glance</span>(clim_fit)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(clim_fit) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>label_txt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Trend: "</span>, <span class="fu">round</span>(slope, <span class="dv">3</span>), <span class="st">" °C/Jahr"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | R² = "</span>, <span class="fu">round</span>(gl<span class="sc">$</span>r.squared, <span class="dv">2</span>),</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | p = "</span>, <span class="fu">signif</span>(gl<span class="sc">$</span>p.value, <span class="dv">2</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>p_clim_ts_up <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(clim_year, <span class="fu">aes</span>(year, t2m_C_mean_summer)) <span class="sc">+</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#00B8D9"</span>,</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"label"</span>,</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">max</span>(clim_year<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">min</span>(clim_year<span class="sc">$</span>t2m_C_mean_summer, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fl">0.15</span>,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> label_txt,</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"TimeSeries: Summer temperature for Fox Glacier"</span>,</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Annual mean 2 m temperature (Jan–Mar) from ERA5-Land"</span>,</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"T2m mean [°C]"</span>,) <span class="sc">+</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in annotate("label", x = max(clim_year$year, na.rm = TRUE) - 1, :
Ignoring unknown parameters: `label.size`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_climate/fox_summerTemp_timeseries.png"</span>, p_clim_ts_up, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">200</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
</div>
</section>
<section id="plot-preciptation-temperature-snow-proxy-cold-weighted-preciptation" class="level1">
<h1>6. Plot: Preciptation + Temperature = Snow-proxy (cold-weighted preciptation)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># precip only helps if it's cold enough</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>T0 <span class="ot">&lt;-</span> <span class="fl">1.0</span>  <span class="co"># °C threshold (snow to rain)</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>kW <span class="ot">&lt;-</span> <span class="fl">1.5</span>  <span class="co"># smoothness (bigger = flat translation, low = scharper)</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>area_snowproxy <span class="ot">&lt;-</span> area_strict_c <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">snow_weight =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>((t2m_C_mean_season <span class="sc">-</span> T0) <span class="sc">/</span> kW)),   <span class="co"># if t2m_C_mean_season colder then T0 = expression(negative) low = 1, if warmer expression(positive) = 0</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">tp_snowproxy =</span> tp_mm_sum_season <span class="sc">*</span> snow_weight</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  )<span class="co">#snow proxy: much cold preciptation = high tp_snowproxy (high accumulation of snow), much warm preciptation = tp_snowproxy low (rain, no development for glacier)</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>m_area_snowproxy <span class="ot">&lt;-</span> <span class="fu">lm</span>(glacier_km2 <span class="sc">~</span> tp_snowproxy, <span class="at">data =</span> area_snowproxy)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(m_area_snowproxy))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = glacier_km2 ~ tp_snowproxy, data = area_snowproxy)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.1912 -0.9097  0.6295  1.3423  4.2875 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   56.3218     1.3410   42.00   &lt;2e-16 ***
tp_snowproxy   0.3128     0.1378    2.27   0.0329 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.549 on 23 degrees of freedom
Multiple R-squared:  0.1831,    Adjusted R-squared:  0.1475 
F-statistic: 5.154 on 1 and 23 DF,  p-value: 0.03288</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>m_area_snowproxy_T <span class="ot">&lt;-</span> <span class="fu">lm</span>(glacier_km2 <span class="sc">~</span> tp_snowproxy <span class="sc">+</span> t2m_C_mean_season, <span class="at">data =</span> area_snowproxy)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(m_area_snowproxy_T))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = glacier_km2 ~ tp_snowproxy + t2m_C_mean_season, 
    data = area_snowproxy)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.4437 -0.6447  0.9703  1.5236  3.1459 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        76.4623    11.5703   6.608 1.21e-06 ***
tp_snowproxy       -0.2441     0.3443  -0.709   0.4858    
t2m_C_mean_season  -3.3639     1.9205  -1.752   0.0938 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.442 on 22 degrees of freedom
Multiple R-squared:  0.283, Adjusted R-squared:  0.2179 
F-statistic: 4.342 on 2 and 22 DF,  p-value: 0.02573</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>m_area_snowproxy <span class="ot">&lt;-</span> <span class="fu">lm</span>(glacier_km2 <span class="sc">~</span> tp_snowproxy, <span class="at">data =</span> area_snowproxy)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>gl <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">glance</span>(m_area_snowproxy)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(m_area_snowproxy) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"tp_snowproxy"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>label_txt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Slope: "</span>, <span class="fu">round</span>(slope, <span class="dv">3</span>), <span class="st">" km² per mm"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | R² = "</span>, <span class="fu">round</span>(gl<span class="sc">$</span>r.squared, <span class="dv">2</span>),</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | p = "</span>, <span class="fu">signif</span>(gl<span class="sc">$</span>p.value, <span class="dv">2</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>p_area_snowproxy_col <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  area_snowproxy,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> tp_snowproxy, <span class="at">y =</span> glacier_km2, <span class="at">color =</span> snow_weight)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.6</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>),               </span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#00B8D9"</span>,</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Snow fraction</span><span class="sc">\n</span><span class="st">(1=much snow-weight, 0=not much)"</span>,</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">limits =</span> <span class="fu">quantile</span>(area_snowproxy<span class="sc">$</span>snow_weight, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">oob =</span> scales<span class="sc">::</span>squish</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Combination: Area vs snowfall-precipitation for the Fox Glacier (Aug–May)"</span>,</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Effectiveness by Preciptation for increasing Glacier-area of cold Seasons"</span>,</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">"Cold-weighted precipitation [mm]"</span>,</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Area proxy [km"</span><span class="sc">^</span><span class="dv">2</span>, <span class="st">"]"</span>)),</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_climate/fox_area_vs_snowproxy.png"</span>, p_area_snowproxy_col, <span class="at">width =</span> <span class="fl">8.5</span>, <span class="at">height =</span> <span class="fl">5.2</span>, <span class="at">dpi =</span> <span class="dv">200</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
</div>
<p>#7. Plot: Anomaly TimeSeries</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Baseline </span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>base_start <span class="ot">&lt;-</span> <span class="dv">1991</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>base_end   <span class="ot">&lt;-</span> <span class="dv">2020</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Mean baseline</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>area_anom <span class="ot">&lt;-</span> area_strict_c <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_base =</span> year <span class="sc">&gt;=</span> base_start <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> base_end)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>base_vals <span class="ot">&lt;-</span> area_anom <span class="sc">%&gt;%</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(in_base) <span class="sc">%&gt;%</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">tp_base   =</span> <span class="fu">mean</span>(tp_mm_sum_season, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_base    =</span> <span class="fu">mean</span>(t2m_C_mean_season, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">area_base =</span> <span class="fu">mean</span>(glacier_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>tp_base   <span class="ot">&lt;-</span> base_vals<span class="sc">$</span>tp_base</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>t_base    <span class="ot">&lt;-</span> base_vals<span class="sc">$</span>t_base</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>area_base <span class="ot">&lt;-</span> base_vals<span class="sc">$</span>area_base</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the Anomalie</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>area_anom <span class="ot">&lt;-</span> area_anom <span class="sc">%&gt;%</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">tp_anom   =</span> tp_mm_sum_season <span class="sc">-</span> tp_base,</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_anom    =</span> t2m_C_mean_season <span class="sc">-</span> t_base,</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">area_anom =</span> glacier_km2 <span class="sc">-</span> area_base</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Baseline:"</span>, base_start, <span class="st">"-"</span>, base_end, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Baseline: 1991 - 2020 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(base_vals)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   tp_base   t_base area_base
1 95.25449 4.348737  59.59845</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Models on anomalies # sensitivity on temperature</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>m_anom_T   <span class="ot">&lt;-</span> <span class="fu">lm</span>(area_anom <span class="sc">~</span> t_anom, <span class="at">data =</span> area_anom)         <span class="co"># temp and precip together</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>m_anom_TP  <span class="ot">&lt;-</span> <span class="fu">lm</span>(area_anom <span class="sc">~</span> t_anom <span class="sc">+</span> tp_anom, <span class="at">data =</span> area_anom) </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># interation of both</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>m_anom_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(area_anom <span class="sc">~</span> t_anom <span class="sc">*</span> tp_anom, <span class="at">data =</span> area_anom)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(m_anom_T))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = area_anom ~ t_anom, data = area_anom)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.4982 -0.4850  0.6937  1.6377  3.6435 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  -0.1483     0.4950  -0.300  0.76722   
t_anom       -2.1063     0.7284  -2.892  0.00823 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.415 on 23 degrees of freedom
Multiple R-squared:  0.2666,    Adjusted R-squared:  0.2348 
F-statistic: 8.363 on 1 and 23 DF,  p-value: 0.008226</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(m_anom_TP))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = area_anom ~ t_anom + tp_anom, data = area_anom)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.6124 -1.9671  0.6853  1.4211  3.5703 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) -0.17662    0.48642  -0.363  0.72000   
t_anom      -2.27974    0.72623  -3.139  0.00477 **
tp_anom     -0.05468    0.04004  -1.366  0.18585   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.371 on 22 degrees of freedom
Multiple R-squared:  0.324, Adjusted R-squared:  0.2625 
F-statistic: 5.271 on 2 and 22 DF,  p-value: 0.01348</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(m_anom_int))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = area_anom ~ t_anom * tp_anom, data = area_anom)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.5997 -1.1448  0.6153  1.3600  3.6002 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)    -0.15975    0.49581  -0.322  0.75049   
t_anom         -2.20477    0.75277  -2.929  0.00802 **
tp_anom        -0.06451    0.04495  -1.435  0.16599   
t_anom:tp_anom  0.02446    0.04737   0.516  0.61096   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.412 on 21 degrees of freedom
Multiple R-squared:  0.3324,    Adjusted R-squared:  0.2371 
F-statistic: 3.486 on 3 and 21 DF,  p-value: 0.03389</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensitivity automation (ΔArea per +1°C)</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>bT  <span class="ot">&lt;-</span> <span class="fu">coef</span>(m_anom_T)[[<span class="st">"t_anom"</span>]]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>ciT <span class="ot">&lt;-</span> <span class="fu">confint</span>(m_anom_T)[<span class="st">"t_anom"</span>, ]</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">SENSITIVITY: per +1°C (Aug–May), area_anom changes by"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(bT, <span class="dv">2</span>), <span class="st">"km² (95% CI:"</span>, <span class="fu">round</span>(ciT[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">"to"</span>, <span class="fu">round</span>(ciT[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SENSITIVITY: per +1°C (Aug–May), area_anom changes by -2.11 km² (95% CI: -3.61 to -0.6 )</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TimeSeries: anomalie</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>anom_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(area_anom <span class="sc">~</span> year, <span class="at">data =</span> area_anom)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>gl <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">glance</span>(anom_fit)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(anom_fit) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>label_txt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Trend: "</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>), <span class="st">" km²/Year"</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | R² = "</span>, <span class="fu">round</span>(gl<span class="sc">$</span>r.squared, <span class="dv">2</span>),</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | p = "</span>, <span class="fu">signif</span>(gl<span class="sc">$</span>p.value, <span class="dv">2</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>p_anom_ts_up <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(area_anom, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> area_anom)) <span class="sc">+</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.4</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#00B8D9"</span>) <span class="sc">+</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"label"</span>,</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">max</span>(area_anom<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">min</span>(area_anom<span class="sc">$</span>area_anom, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fl">0.6</span>,</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> label_txt,</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.9</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Area anomaly of the Fox Glacier (1991-2020)"</span>),</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"when was the Glacier under the Reference-Niveau (Aug–May)"</span>,</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Area anomaly [km"</span><span class="sc">^</span><span class="dv">2</span>, <span class="st">"]"</span>)),</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in annotate("label", x = max(area_anom$year, na.rm = TRUE) - 1, :
Ignoring unknown parameters: `label.size`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save and export</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_climate/fox_area_anomaly_timeseries.png"</span>, p_anom_ts_up, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">200</span>) </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Export csv (for the step 8)</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(snow_df, <span class="st">"fox_snowline_clean.csv"</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(area_strict, <span class="st">"fox_area_clean_strict.csv"</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(area_anom, <span class="st">"fox_area_strict_with_anomalies.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="hypsometrie-of-snowarea-with-snowline-overlay" class="level1">
<h1>8. Hypsometrie of Snowarea with Snowline Overlay</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (Measurement and representation of the distribution of elevations and depressions on the Earth's surface relative to sea level)</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Where at the Glacier is Snow-Area missing</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We Need the GEE-Output: glacier_hypo</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Hypsometry of snow/ice area with snowline overlay (robust)</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">#data</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>hypso_path    <span class="ot">&lt;-</span> <span class="st">"./data/raw/Fox_hypsometry_bins.csv"</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>snowline_path <span class="ot">&lt;-</span> <span class="st">"fox_snowline_clean.csv"</span>   <span class="co"># from earlier chapter</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co"># lables</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Hypsometry file contain "Early/Late" = "pre-2006/post-2006"</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>map_to_period <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.character</span>(x)</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Early"</span>, <span class="st">"early"</span>, <span class="st">"pre"</span>, <span class="st">"pre2006"</span>, <span class="st">"pre-2006"</span>, <span class="st">"Pre-2006"</span>) <span class="sc">~</span> <span class="st">"pre-2006"</span>,</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Late"</span>, <span class="st">"late"</span>, <span class="st">"post"</span>, <span class="st">"post2006"</span>, <span class="st">"post-2006"</span>, <span class="st">"Post-2006"</span>) <span class="sc">~</span> <span class="st">"post-2006"</span>,</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>period_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pre-2006"</span>, <span class="st">"post-2006"</span>)</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(hypso_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_group_raw =</span> year_group,</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_group =</span> <span class="fu">map_to_period</span>(year_group),</span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_group =</span> <span class="fu">factor</span>(year_group, <span class="at">levels =</span> period_levels),</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">elev_bin   =</span> <span class="fu">as.numeric</span>(elev_bin),</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">area_km2   =</span> <span class="fu">as.numeric</span>(area_km2)</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year_group), <span class="sc">!</span><span class="fu">is.na</span>(elev_bin), <span class="sc">!</span><span class="fu">is.na</span>(area_km2)) <span class="sc">%&gt;%</span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year_group, elev_bin)</span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">levels</span>(<span class="fu">droplevels</span>(hyp<span class="sc">$</span>year_group)) <span class="sc">%in%</span> period_levels))</span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a><span class="co"># snowline groups</span></span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>snowline_groups <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(snowline_path)) {</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>  snow <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(snowline_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">transmute</span>(</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">year =</span> <span class="fu">as.integer</span>(year),</span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">snowline_edge_m =</span> <span class="fu">as.numeric</span>(snowline_edge_m)</span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), <span class="sc">!</span><span class="fu">is.na</span>(snowline_edge_m))</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>  summarise_snow <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, y_min, y_max, label){</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&gt;=</span> y_min, year <span class="sc">&lt;=</span> y_max) <span class="sc">%&gt;%</span></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_years =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(),</span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">snowline_mean_m =</span> <span class="fu">mean</span>(snowline_edge_m, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">snowline_p10_m  =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(snowline_edge_m, <span class="fl">0.10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">snowline_p90_m  =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(snowline_edge_m, <span class="fl">0.90</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>    out<span class="sc">$</span>year_group <span class="ot">&lt;-</span> label  </span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># default split at 2006</span></span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a>  pre  <span class="ot">&lt;-</span> <span class="fu">summarise_snow</span>(snow, <span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">2005</span>L, <span class="st">"pre-2006"</span>)</span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> <span class="fu">summarise_snow</span>(snow, <span class="dv">2006</span>L,  <span class="cn">Inf</span>, <span class="st">"post-2006"</span>)</span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fallback split if one side is empty</span></span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (pre<span class="sc">$</span>n_years <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> post<span class="sc">$</span>n_years <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a>    yrs <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(snow<span class="sc">$</span>year))</span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a>    mid <span class="ot">&lt;-</span> yrs[<span class="fu">floor</span>(<span class="fu">length</span>(yrs) <span class="sc">/</span> <span class="dv">2</span>)]</span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a>    pre  <span class="ot">&lt;-</span> <span class="fu">summarise_snow</span>(snow, <span class="fu">min</span>(yrs), mid, <span class="st">"pre-2006"</span>)</span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a>    post <span class="ot">&lt;-</span> <span class="fu">summarise_snow</span>(snow, mid <span class="sc">+</span> <span class="dv">1</span>L, <span class="fu">max</span>(yrs), <span class="st">"post-2006"</span>)</span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only build if both groups have data</span></span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (pre<span class="sc">$</span>n_years <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> post<span class="sc">$</span>n_years <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a>    snowline_groups <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(pre, post) <span class="sc">%&gt;%</span></span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(year_group, snowline_mean_m, snowline_p10_m, snowline_p90_m) <span class="sc">%&gt;%</span></span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">year_group =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(year_group), <span class="at">levels =</span> period_levels)</span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb72-89"><a href="#cb72-89" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb72-90"><a href="#cb72-90" aria-hidden="true" tabindex="-1"></a>    snowline_groups <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb72-91"><a href="#cb72-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-92"><a href="#cb72-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-93"><a href="#cb72-93" aria-hidden="true" tabindex="-1"></a><span class="co"># median</span></span>
<span id="cb72-94"><a href="#cb72-94" aria-hidden="true" tabindex="-1"></a>w_median <span class="ot">&lt;-</span> <span class="cf">function</span>(x, w){</span>
<span id="cb72-95"><a href="#cb72-95" aria-hidden="true" tabindex="-1"></a>  o <span class="ot">&lt;-</span> <span class="fu">order</span>(x)</span>
<span id="cb72-96"><a href="#cb72-96" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[o]; w <span class="ot">&lt;-</span> w[o]</span>
<span id="cb72-97"><a href="#cb72-97" aria-hidden="true" tabindex="-1"></a>  cw <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(w) <span class="sc">/</span> <span class="fu">sum</span>(w)</span>
<span id="cb72-98"><a href="#cb72-98" aria-hidden="true" tabindex="-1"></a>  x[<span class="fu">min</span>(<span class="fu">which</span>(cw <span class="sc">&gt;=</span> <span class="fl">0.5</span>))]</span>
<span id="cb72-99"><a href="#cb72-99" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-100"><a href="#cb72-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-101"><a href="#cb72-101" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate metrics</span></span>
<span id="cb72-102"><a href="#cb72-102" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> hyp <span class="sc">%&gt;%</span></span>
<span id="cb72-103"><a href="#cb72-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year_group) <span class="sc">%&gt;%</span></span>
<span id="cb72-104"><a href="#cb72-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb72-105"><a href="#cb72-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_area_km2 =</span> <span class="fu">sum</span>(area_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-106"><a href="#cb72-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">elev_w_median  =</span> <span class="fu">w_median</span>(elev_bin, area_km2),</span>
<span id="cb72-107"><a href="#cb72-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">elev_w_mean    =</span> <span class="fu">sum</span>(elev_bin <span class="sc">*</span> area_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(area_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-108"><a href="#cb72-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb72-109"><a href="#cb72-109" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-110"><a href="#cb72-110" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  year_group total_area_km2 elev_w_median elev_w_mean
  &lt;fct&gt;               &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
1 pre-2006             59.7          2250       2155.
2 post-2006            58.5          2200       2147.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AAR-Proxy = Accumulation Area Ratio (How much snow stays on the glacier above the snowline)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>aar <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(snowline_groups)) {</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  aar <span class="ot">&lt;-</span> hyp <span class="sc">%&gt;%</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(snowline_groups, year_group, snowline_mean_m),</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"year_group"</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(year_group) <span class="sc">%&gt;%</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">snowline_mean_m =</span> dplyr<span class="sc">::</span><span class="fu">first</span>(snowline_mean_m),</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">area_total =</span> <span class="fu">sum</span>(area_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">area_above_snowline =</span> <span class="fu">sum</span>(area_km2[elev_bin <span class="sc">&gt;=</span> snowline_mean_m], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">aar_proxy =</span> area_above_snowline <span class="sc">/</span> area_total,</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(aar)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  year_group snowline_mean_m area_total area_above_snowline aar_proxy
  &lt;fct&gt;                &lt;dbl&gt;      &lt;dbl&gt;               &lt;dbl&gt;     &lt;dbl&gt;
1 pre-2006             1983.       59.7                41.8     0.700
2 post-2006            2299.       58.5                26.1     0.446</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot:  Hypsometry distribution</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>blue_post <span class="ot">&lt;-</span> <span class="st">"#00B8D9"</span>   </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>red_pre   <span class="ot">&lt;-</span> <span class="st">"#E76F51"</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>p_hypso <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hyp, <span class="fu">aes</span>(elev_bin, area_km2, <span class="at">color =</span> year_group)) <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.05</span>) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.9</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"pre-2006"</span> <span class="ot">=</span> red_pre, <span class="st">"post-2006"</span> <span class="ot">=</span> blue_post),</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"pre-2006"</span>, <span class="st">"post-2006"</span>)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Elevation distribution of Snowarea for the Fox Glacier (Aug–May)"</span>,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Mean Snow-area [km2] per elevation; pre-2006 vs post-2006"</span>,</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Elevation [m]"</span>,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Mean Snowarea per class (band) [km"</span><span class="sc">^</span><span class="dv">2</span>, <span class="st">"]"</span>)),</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Period"</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(snowline_groups)) {</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>  p_hypso <span class="ot">&lt;-</span> p_hypso <span class="sc">+</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> snowline_groups,</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">xintercept =</span> snowline_mean_m, <span class="at">color =</span> year_group),</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_hypsometry/fox_hypso_distribution.png"</span>, p_hypso, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">250</span>)</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: Cumulative area above elevation </span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>red_pre   <span class="ot">&lt;-</span> <span class="st">"#E76F51"</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>blue_post <span class="ot">&lt;-</span> <span class="st">"#00B8D9"</span> </span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>hyp_cum <span class="ot">&lt;-</span> hyp <span class="sc">%&gt;%</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year_group) <span class="sc">%&gt;%</span></span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(elev_bin) <span class="sc">%&gt;%</span></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cum_above_km2 =</span> <span class="fu">rev</span>(<span class="fu">cumsum</span>(<span class="fu">rev</span>(area_km2)))) <span class="sc">%&gt;%</span></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>p_cum <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hyp_cum, <span class="fu">aes</span>(elev_bin, cum_above_km2, <span class="at">color =</span> year_group)) <span class="sc">+</span></span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.15</span>) <span class="sc">+</span></span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"pre-2006"</span> <span class="ot">=</span> red_pre, <span class="st">"post-2006"</span> <span class="ot">=</span> blue_post),</span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"pre-2006"</span>, <span class="st">"post-2006"</span>)</span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cumulative Snowarea above elevation for Fox Glacier"</span>,</span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Cumulative mean area remaining above a given elevation"</span>,</span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Elevation [m]"</span>, <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Cumulative area above elevation [km"</span><span class="sc">^</span><span class="dv">2</span>, <span class="st">"]"</span>)),</span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Period"</span></span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(snowline_groups)) {</span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-71"><a href="#cb76-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Snowline vertical lines</span></span>
<span id="cb76-72"><a href="#cb76-72" aria-hidden="true" tabindex="-1"></a>  p_cum <span class="ot">&lt;-</span> p_cum <span class="sc">+</span></span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(</span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> snowline_groups,</span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">xintercept =</span> snowline_mean_m, <span class="at">color =</span> year_group),</span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.85</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb76-77"><a href="#cb76-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb76-78"><a href="#cb76-78" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Compute AAR points from hyp_cum at the snowline elevation</span></span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true" tabindex="-1"></a>  aar_pts <span class="ot">&lt;-</span> hyp_cum <span class="sc">%&gt;%</span></span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(year_group) <span class="sc">%&gt;%</span></span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">area_total =</span> <span class="fu">max</span>(cum_above_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-83"><a href="#cb76-83" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb76-84"><a href="#cb76-84" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(snowline_groups, year_group, snowline_mean_m),</span>
<span id="cb76-85"><a href="#cb76-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"year_group"</span></span>
<span id="cb76-86"><a href="#cb76-86" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb76-87"><a href="#cb76-87" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(hyp_cum, <span class="at">by =</span> <span class="st">"year_group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-88"><a href="#cb76-88" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(year_group, area_total, snowline_mean_m) <span class="sc">%&gt;%</span></span>
<span id="cb76-89"><a href="#cb76-89" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb76-90"><a href="#cb76-90" aria-hidden="true" tabindex="-1"></a>      <span class="co"># nearest cum-value at snowline elevation</span></span>
<span id="cb76-91"><a href="#cb76-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">area_above_snowline =</span> cum_above_km2[<span class="fu">which.min</span>(<span class="fu">abs</span>(elev_bin <span class="sc">-</span> snowline_mean_m))],</span>
<span id="cb76-92"><a href="#cb76-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">elev_at =</span> elev_bin[<span class="fu">which.min</span>(<span class="fu">abs</span>(elev_bin <span class="sc">-</span> snowline_mean_m))],</span>
<span id="cb76-93"><a href="#cb76-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb76-94"><a href="#cb76-94" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb76-95"><a href="#cb76-95" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb76-96"><a href="#cb76-96" aria-hidden="true" tabindex="-1"></a>      <span class="at">aar_proxy =</span> area_above_snowline <span class="sc">/</span> area_total,</span>
<span id="cb76-97"><a href="#cb76-97" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">paste0</span>(</span>
<span id="cb76-98"><a href="#cb76-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">"AAR ≈ "</span>, scales<span class="sc">::</span><span class="fu">percent</span>(aar_proxy, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb76-99"><a href="#cb76-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Area above snowline: "</span>, <span class="fu">round</span>(area_above_snowline, <span class="dv">1</span>), <span class="st">" km²"</span></span>
<span id="cb76-100"><a href="#cb76-100" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb76-101"><a href="#cb76-101" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-102"><a href="#cb76-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Add point + label</span></span>
<span id="cb76-103"><a href="#cb76-103" aria-hidden="true" tabindex="-1"></a>  p_cum <span class="ot">&lt;-</span> p_cum <span class="sc">+</span></span>
<span id="cb76-104"><a href="#cb76-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb76-105"><a href="#cb76-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> aar_pts,</span>
<span id="cb76-106"><a href="#cb76-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> elev_at, <span class="at">y =</span> area_above_snowline, <span class="at">color =</span> year_group),</span>
<span id="cb76-107"><a href="#cb76-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="fl">2.6</span>,</span>
<span id="cb76-108"><a href="#cb76-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb76-109"><a href="#cb76-109" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb76-110"><a href="#cb76-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label</span>(</span>
<span id="cb76-111"><a href="#cb76-111" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> aar_pts,</span>
<span id="cb76-112"><a href="#cb76-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> elev_at, <span class="at">y =</span> area_above_snowline, <span class="at">label =</span> label, <span class="at">color =</span> year_group),</span>
<span id="cb76-113"><a href="#cb76-113" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb76-114"><a href="#cb76-114" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha =</span> <span class="fl">0.9</span>,</span>
<span id="cb76-115"><a href="#cb76-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb76-116"><a href="#cb76-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="fl">3.2</span>,</span>
<span id="cb76-117"><a href="#cb76-117" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.6</span>,</span>
<span id="cb76-118"><a href="#cb76-118" aria-hidden="true" tabindex="-1"></a>      <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb76-119"><a href="#cb76-119" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-120"><a href="#cb76-120" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `label.size` argument of `geom_label()` is deprecated as of ggplot2 3.5.0.
ℹ Please use the `linewidth` argument instead.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_hypsometry/fox_hypso_cumulative_above.png"</span>, p_cum, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">250</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: Difference per class/band (post-2006 minus pre-2006) </span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>red_pre   <span class="ot">&lt;-</span> <span class="st">"#E76F51"</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>blue_post <span class="ot">&lt;-</span> <span class="st">"#00B8D9"</span>  </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>hyp_wide <span class="ot">&lt;-</span> hyp <span class="sc">%&gt;%</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(year_group, elev_bin, area_km2) <span class="sc">%&gt;%</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year_group, <span class="at">values_from =</span> area_km2) <span class="sc">%&gt;%</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_km2 =</span> <span class="st">`</span><span class="at">post-2006</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">pre-2006</span><span class="st">`</span>,</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_dir =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(diff_km2 <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="st">"Gain (post &gt; pre)"</span>, <span class="st">"Loss (post &lt; pre)"</span>)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>p_diff <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hyp_wide, <span class="fu">aes</span>(elev_bin, diff_km2)) <span class="sc">+</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> change_dir), <span class="at">size =</span> <span class="fl">1.6</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Loss (post &lt; pre)"</span> <span class="ot">=</span> red_pre, <span class="st">"Gain (post &gt; pre)"</span> <span class="ot">=</span> blue_post)</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Hypsometry change for the Fox Glacier(post-2006 − pre-2006)"</span>,</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Positive values = more snowarea in post-2006 within that elevation class/band; negative = loss"</span>,</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Elevation [m]"</span>,</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Change in mean area per class/band [km"</span><span class="sc">^</span><span class="dv">2</span>, <span class="st">"]"</span>)),</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots_hypsometry/fox_hypso_diff_post_minus_pre.png"</span>, p_diff, <span class="at">width =</span> <span class="dv">9</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">250</span>)</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: Accumulation Area Ratio (AAR)</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>red_pre   <span class="ot">&lt;-</span> <span class="st">"#E76F51"</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>blue_post <span class="ot">&lt;-</span> <span class="st">"#00B8D9"</span></span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(aar)) {</span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a>  aar2 <span class="ot">&lt;-</span> aar <span class="sc">%&gt;%</span></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">period =</span> <span class="fu">factor</span>(year_group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"pre-2006"</span>,<span class="st">"post-2006"</span>),</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Before 2006"</span>, <span class="st">"After 2006"</span>)),</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">pct =</span> aar_proxy <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span> <span class="fu">round</span>(aar2<span class="sc">$</span>pct[aar2<span class="sc">$</span>period<span class="sc">==</span><span class="st">"After 2006"</span>] <span class="sc">-</span> aar2<span class="sc">$</span>pct[aar2<span class="sc">$</span>period<span class="sc">==</span><span class="st">"Before 2006"</span>], <span class="dv">1</span>)</span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>  p_aar_simple <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(aar2, <span class="fu">aes</span>(period, pct, <span class="at">fill =</span> period)) <span class="sc">+</span></span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.62</span>, <span class="at">alpha =</span> <span class="fl">0.95</span>) <span class="sc">+</span></span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(pct, <span class="dv">0</span>), <span class="st">"%"</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.4</span>,</span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a>              <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Before 2006"</span> <span class="ot">=</span> red_pre, <span class="st">"After 2006"</span> <span class="ot">=</span> blue_post)) <span class="sc">+</span></span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">25</span>),</span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a>                       <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.08</span>))) <span class="sc">+</span></span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Percentage of snowarea above the snowline"</span>,</span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"After 2006: "</span>, <span class="fu">abs</span>(delta), <span class="st">" percentage points "</span>,</span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(delta <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"lower"</span>, <span class="st">"higher"</span>),</span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a>                        <span class="st">" → less potential accumulation area"</span>),</span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Area above snowline [%]"</span></span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">"plots_hypsometry/fox_area_above_snowline_share.png"</span>, p_aar_simple, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="fl">4.5</span>, <span class="at">dpi =</span> <span class="dv">250</span>)</span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a><span class="co"># tables</span></span>
<span id="cb78-81"><a href="#cb78-81" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(metrics, <span class="st">"fox_hypso_metrics_by_group.csv"</span>)</span>
<span id="cb78-82"><a href="#cb78-82" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(aar)) readr<span class="sc">::</span><span class="fu">write_csv</span>(aar, <span class="st">"fox_hypso_aar_proxy.csv"</span>)</span>
<span id="cb78-83"><a href="#cb78-83" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(snowline_groups)) readr<span class="sc">::</span><span class="fu">write_csv</span>(snowline_groups, <span class="st">"fox_snowline_groups_for_hypso.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>